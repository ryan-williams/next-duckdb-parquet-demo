# next.js / duckdb-wasm parquet demo
Example [Next.js] app using [duckdb-wasm] to read/fetch Parquet files, in Node and the browser.

## Relevant files:
- [pages/index.tsx](pages/index.tsx): homepage showing 3 ways of loading Parquet data (on a mix of client and server)
- [src/parquet.ts](src/parquet.ts): utilities for instantiating DuckDB and fetching/loading Parquet data
  - copied from [runsascoded/next-utils/parquet.ts], adapted from [ilyabo/graphnavi/lib/useDuckConn.ts]
  - see also [duckdb-wasm#1148]
- [public/people.parquet](public/people.parquet): demo Parquet file, generated by [init-data.js](init-data.js)

## Live demo
[runsascoded.com/next-duckdb-parquet-demo](https://runsascoded/next-duckdb-parquet-demo):
> Parquet data loaded on server (in `getStaticProps`, with `loadParquet`):
> ```json
> [{"id":1,"name":"Mark"},{"id":2,"name":"Hannes"}]
> ```
> Parquet data buffer loaded on server, parsed on client (with `useParquetBuf`):
> ```json
> [{"id":1,"name":"Mark"},{"id":2,"name":"Hannes"}]
> ```
> Parquet data fetched on client, from [`runsascoded.com/next-duckdb-parquet-demo`](https://runsascoded.com/next-duckdb-parquet-demo) (with `useParquet`):
> ```json
> [{"id":1,"name":"Mark"},{"id":2,"name":"Hannes"}]
> ```

## Run locally
Dev mode:
```bash
next dev  # serve dev-mode site at http://127.0.0.1:3000
```

Build + Export:
```bash
next build
next export
http-server out  # serve static site from out/ dir
```

## Generate sample data
```bash
node init-data.js
```

Runs [init-data.js](init-data.js):
```node
const duckdb = require('duckdb')
const db = new duckdb.Database(':memory:')
db.run(`
CREATE TABLE people(id INTEGER, name VARCHAR);
INSERT INTO people VALUES (1, 'Mark'), (2, 'Hannes');
COPY (SELECT * FROM people) TO 'public/people.parquet' (FORMAT 'parquet');
`)
```

[Next.js]: https://nextjs.org/
[duckdb-wasm]: https://github.com/duckdb/duckdb-wasm
[runsascoded/next-utils/parquet.ts]: https://github.com/runsascoded/next-utils/blob/25af539a1518dcc786de0892f265eb6c0245287a/src/parquet.ts
[ilyabo/graphnavi/lib/useDuckConn.ts]: https://github.com/ilyabo/graphnavi/blob/fd89fe77edd48614cc5a52772b5f9f66b214bbea/lib/useDuckConn.ts
[duckdb-wasm#1148]: https://github.com/duckdb/duckdb-wasm/issues/1148
